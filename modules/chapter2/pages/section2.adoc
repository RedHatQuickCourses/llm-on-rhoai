= Modifying the OpenShift AI TLS Certificate

video::openshiftai_tls.mp4[width=640]

[NOTE]

An SSL/TLS certificate is a digital object that allows systems to verify the identity & subsequently establish an encrypted network connection to another system using the Secure Sockets Layer/Transport Layer Security (SSL/TLS) protocol.

By default, the Single Model Serving Platform in Openshift AI uses a self-signed certificate generated during installation for the endpoints that are created when deploying a Model server. 

This can be counterintuitive because the OCP Cluster already has certificates configured which will be used by default for endpoints like Routes. 

This following procedure explains how to use the same certificate from the OpenShift Container cluster for OpenShift AI.

== Use OpenShift Certificates for Ingress Routes

[NOTE]
Most customers will not use the self-signed certificates, opting instead to use certificates generated by their own authority.  Therefore, this step of adding secrets to OpenShift & OpenShift AI is common process during installation.

=== Navigate to the OpenShift Container Cluster Dashboard

The content of the Secret (data) should contain two items, *tls.cert* and *tls.key*. They are the certificate and key that are used for all the OpenShift Routes.

*Collect the Secret YAML Text:* 

    . In the Navigation pane on the left, click on the *Workloads* section, then *Secrets* under Workloads.
    . From the Project dropdown, toggle the *show default projects* radial button to on. 
    . Select the *openshift-ingress* project from the list. 

image::openshiftingress_project.png[width=640]

    . Locate the file named *ingress-certs-(XX-XX-2024)*, type should be *Opaque*
    . Click on the filename to open the secret, Select the *YAML Tab*
    . Copy all the text from the window, and ensure that you scroll down.  (CTL-A should work).

*Clean & Deploy the Secret YAML Text:* 

    * Click on the Project dropdown again, select the *Istio-system* project
    * Select the *Create* button on the right, then Select the *from YAML* option.
    * Delete the text from the Window, and *paste the copied Secret text*

    * Cleanup the YAML Text to just keep the relevant content. It should look like the below YAML file (the name of the secret will be different, it's normally tied to the date the RDHP Cluster was deployed). Change the type to *kubernetes.io/tls*.

```yaml
kind: Secret
apiVersion: v1
metadata:
name: ingress-certs-05-28-2024
data:
tls.crt: >-
    LS0tLS1CRUd...
tls.key: >-
    LS0tLS1CRUd...
type: kubernetes.io/tls
```
image::createsecret.png[width=640]


* Copy the name of the secret from line 4, just the name  (optional, but helpful)
* Click *create* to apply this YAML into the istio-system proejct (namespace).

*We have copied the Secret used by OCP & made it available be used by OAI.*




== Create OpenShift AI Data Science Cluster

With our secrets in place, the next step is to create OpenShift AI *Data Science Cluster*.

Return to the OpenShift Navigation Menu, Select Installed Operators, and Click on the OpenShift AI Operator name to open the operator.

 . *Select the Option to create a Data Science Cluster.*

 . *Select the radial button to switch to the YAML view.*

 . Find the section below in the YAML file, in the Kserve Section find the Serving/Certificate area; add the line: *secretName:* followed by the name of the secret name that we deployed in the istio-system project. In addition, change the type from SelfSigned to *Provided*. See below for the example.

```yaml
kserve:
devFlags: {}
managementState: Managed
serving:
    ingressGateway:
    certificate:
        secretName: ingress-certs-XX-XX-2024
        type: Provided
    managementState: Managed
    name: knative-serving
```
image::dcsyamlfile.png[width=640]

Once you have made those changes to the YAML file, *Click Create* to Deploy the Data Science Cluster.  

image::createDSC.png[width=640]

Single Model Serve Platform will now be deployed to expose ingress connections with the same certificate as OpenShift Routes. Endpoints will be accessible using TLS without having to ignore error messages or create special configurations.

== OpenShift AI install summary

Congratulations, you have successfully completed the installation of OpenShift AI on an OpenShift Container Cluster. OpenShift AI is now running on a new Dashboard!


  * We installed the required OpenShift AI Operators
  ** Serverless, ServiceMesh, & Pipelines Operators
  ** OpenShift AI Operator
  ** Web Terminal Operator

Additionally, we took this installation a step further by sharing TLS certificates from the OpenShift Cluster with OpenShift AI. 

We will pick up working with the OpenShift AI UI in the next Chapter.